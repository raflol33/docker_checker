{% extends "base.html" %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Sidebar / Hosts -->
    <div class="lg:col-span-1 space-y-6">
        <div class="bg-gray-800 p-4 rounded-lg border border-gray-700">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                <span>üñ•Ô∏è</span> –£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –•–æ—Å—Ç—ã
            </h2>
            <ul class="space-y-2 mb-4">
                {% for host in hosts %}
                <li class="flex justify-between items-center bg-gray-700/50 p-2 rounded text-sm">
                    <span class="font-mono">{{ host.name }}</span>
                    <div class="flex items-center gap-2">
                        <button
                            class="text-xs bg-purple-900/50 hover:bg-purple-800 text-purple-200 px-2 py-1 rounded border border-purple-700 transition"
                            hx-get="/images/{{ host.name }}" hx-target="body" hx-swap="beforeend">
                            –û–±—Ä–∞–∑—ã
                        </button>
                        <span class="text-xs text-gray-400 uppercase border border-gray-600 px-1 rounded">{{ host.type
                            }}</span>
                    </div>
                </li>
                {% endfor %}
            </ul>

            <details class="text-sm">
                <summary class="cursor-pointer text-blue-400 hover:text-blue-300">–î–æ–±–∞–≤–∏—Ç—å –ù–æ–≤—ã–π –•–æ—Å—Ç</summary>
                <form action="/hosts/add" method="post" class="mt-4 space-y-3 p-2 bg-gray-700/30 rounded">
                    <input type="text" name="name" placeholder="–ò–º—è –•–æ—Å—Ç–∞"
                        class="w-full bg-gray-700 rounded p-2 text-xs border border-gray-600" required>
                    <select name="type" class="w-full bg-gray-700 rounded p-2 text-xs border border-gray-600">
                        <option value="ssh">SSH</option>
                        <option value="local">–õ–æ–∫–∞–ª—å–Ω—ã–π –°–æ–∫–µ—Ç</option>
                    </select>
                    <input type="text" name="ip" placeholder="IP –ê–¥—Ä–µ—Å (SSH)"
                        class="w-full bg-gray-700 rounded p-2 text-xs border border-gray-600">
                    <input type="number" name="port" placeholder="–ü–æ—Ä—Ç (22)"
                        class="w-full bg-gray-700 rounded p-2 text-xs border border-gray-600">
                    <input type="text" name="ssh_user" placeholder="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH"
                        class="w-full bg-gray-700 rounded p-2 text-xs border border-gray-600">
                    <input type="text" name="ssh_password" placeholder="–ü–∞—Ä–æ–ª—å SSH (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                        class="w-full bg-gray-700 rounded p-2 text-xs border border-gray-600">
                    <button class="w-full bg-green-700 hover:bg-green-600 text-white p-2 rounded text-xs">–î–æ–±–∞–≤–∏—Ç—å
                        –•–æ—Å—Ç</button>
                </form>
            </details>
        </div>


    </div>

    <!-- Main Content / Containers -->
    <div class="lg:col-span-3 space-y-6">
        {% if errors %}
        <div class="bg-red-900/50 border border-red-800 p-4 rounded text-sm text-red-200">
            <p class="font-bold">–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏:</p>
            <ul class="list-disc pl-5">
                {% for err in errors %}
                <li>{{ err }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
            <div class="p-4 bg-gray-800 border-b border-gray-700 flex justify-between items-center">
                <h2 class="text-xl font-bold">üì¶ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã</h2>
                <button onclick="location.reload()"
                    class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-sm">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-400 uppercase bg-gray-700/50">
                        <tr>
                            <th class="px-4 py-3">–°—Ç–∞—Ç—É—Å</th>
                            <th class="px-4 py-3">–ò–º—è</th>
                            <th class="px-4 py-3">–û–±—Ä–∞–∑</th>
                            <th class="px-4 py-3">–°–æ–∑–¥–∞–Ω</th>
                            <th class="px-4 py-3">–ü–æ—Ä—Ç—ã</th>
                            <th class="px-4 py-3">–•–æ—Å—Ç</th>
                            <th class="px-4 py-3 text-right">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                        {% for c in containers %}
                        <tr class="hover:bg-gray-700/30 transition">
                            <td class="px-4 py-3 whitespace-nowrap">
                                <div class="flex items-center gap-2">
                                    {% if 'running' in c.state|lower %}
                                    <span
                                        class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]"></span>
                                    {% else %}
                                    <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span>
                                    {% endif %}
                                    <div class="flex flex-col">
                                        <span class="text-xs text-white uppercase font-bold">{{ c.state }}</span>
                                        <span class="text-[10px] text-gray-400 font-mono">{{ c.status }}</span>
                                    </div>
                                </div>
                            </td>
                            <td class="px-4 py-3 font-medium text-white">{{ c.name }}</td>
                            <td class="px-4 py-3 text-gray-300 text-xs font-mono whitespace-normal break-all"
                                title="{{ c.image }}">
                                {{ c.image }}
                            </td>
                            <td class="px-4 py-3 text-gray-400 text-xs font-mono whitespace-nowrap">
                                {{ c.created }}
                            </td>
                            <td class="px-4 py-3 text-gray-400 text-xs font-mono whitespace-normal break-all"
                                title="{{ c.ports }}">
                                {{ c.ports }}
                            </td>
                            <td class="px-4 py-3 text-blue-400 font-mono text-xs">{{ c.host }}</td>
                            <td class="px-4 py-3 text-right flex items-center justify-end gap-2">
                                {% if c.compose_path %}
                                <form hx-post="/compose/action" hx-swap="none" class="flex gap-1"
                                    hx-confirm="–í—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ Compose –¥–ª—è {{ c.compose_path }}?">
                                    <input type="hidden" name="host_name" value="{{ c.host }}">
                                    <input type="hidden" name="path" value="{{ c.compose_path }}">
                                    <button type="submit" name="action" value="down"
                                        class="bg-red-900/50 hover:bg-red-800 text-red-200 px-2 py-1 rounded border border-red-800 transition text-xs flex items-center gap-1"
                                        title="Compose Down">
                                        ‚¨á
                                    </button>
                                    <button type="submit" name="action" value="up"
                                        class="bg-green-900/50 hover:bg-green-800 text-green-200 px-2 py-1 rounded border border-green-800 transition text-xs flex items-center gap-1"
                                        title="Compose Up">
                                        ‚¨Ü
                                    </button>
                                </form>
                                {% endif %}

                                <button hx-get="/containers/{{c.host}}/{{c.id}}/logs" hx-target="#modal-content"
                                    hx-trigger="click" onclick="document.getElementById('log-modal').showModal()"
                                    class="text-gray-400 hover:text-white transition p-1" title="–õ–æ–≥–∏">
                                    üìú
                                </button>
                                <button hx-post="/containers/{{c.host}}/{{c.id}}/restart" hx-swap="none"
                                    class="text-yellow-500 hover:text-yellow-400 transition p-1" title="–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å">
                                    üîÑ
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Å—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Logs -->
<dialog id="log-modal" class="bg-transparent p-0 w-full max-w-4xl backdrop:bg-black/80">
    <div class="bg-gray-900 border border-gray-700 rounded-lg shadow-2xl flex flex-col max-h-[90vh]">
        <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-800 rounded-t-lg">
            <h3 class="font-bold">–õ–æ–≥–∏ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞</h3>
            <button onclick="document.getElementById('log-modal').close()"
                class="text-gray-400 hover:text-white">‚úï</button>
        </div>
        <div id="modal-content" class="p-4 overflow-auto flex-1 font-mono text-xs text-gray-300 whitespace-pre-wrap">
            –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
    </div>
</dialog>
{% endblock %}